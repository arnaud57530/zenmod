<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

    <template id="zenreport_vattemplate">
	    <t t-call="report.html_container">
	        <t t-call="report.internal_layout">
	            <div class="page">
	                <h2>Awtol Tax Statement</h2>
	
	                <div class="row mt32 mb32">
	                    <div class="col-xs-3">
	                        <strong>Chart of Tax:</strong>
	                        <p t-esc="get_account(data)"/>
	                    </div>
	                    <div class="col-xs-3">
	                        <strong>Fiscal Year:</strong>
	                        <p t-esc="get_fiscalyear(data)"/>
	                    </div>
	                    <div class="col-xs-3">
	                        <strong>Periods:</strong>
	                        <p>
	                            Start Period: <span t-esc="get_start_period(data)"/><br/>
	                            End Period: <span t-esc="get_end_period(data)"/>
	                        </p>
	                    </div>
	                </div>
	                <table class="table table-condensed">
	                    <thead>
	                        <tr>
	                            <th class="text-left">Compte</th>
	                            <th class="text-left">TVA</th>
	                            <th class="text-center">Base</th>
	                            <th class="text-center">Tva Débit</th>
	                            <th class="text-center">Tva Crédit</th>
	                        </tr>
	                    </thead>
	                    <t t-set="sumdeb_tot" t-value="0"/>
						<t t-set="sumcre_tot" t-value="0"/>
						<t t-set="sumbase_tot" t-value="0"/>
						<t t-set="sumdeb" t-value="0"/>
						<t t-set="sumcre" t-value="0"/>
						<t t-set="sumbase" t-value="0"/>
						<t t-set="compte" t-value="data['form']['zenvatlines'][0]['code'][0:2]"/>
	                    <tbody>
	                        <tr t-foreach="data['form']['zenvatlines']" t-as="ligne">
	                        	<t t-set="changed" t-value="compte!=ligne['code'][0:2]"/>
	                        	<t t-if="changed">
	                        		<tr>
	                        			<td class="text-right" style="font-weight: bold;">Total compte</td>
	                    				<td class="text-right" style="font-weight: bold;"><span t-esc="compte"/></td>
	                    				<td class="text-center" style="font-weight: bold;"><span t-esc="'{0:,.2f}'.format(sumbase)"/></td>
	                    				<td class="text-center" style="font-weight: bold;"><span t-esc="'{0:,.2f}'.format(sumdeb)"/></td>
	                    				<td class="text-center" style="font-weight: bold;"><span t-esc="'{0:,.2f}'.format(sumcre)"/></td>
	                        		</tr>
	                        		<t t-set="sumdeb" t-value="0"/>
									<t t-set="sumcre" t-value="0"/>
									<t t-set="sumbase" t-value="0"/>
									<t t-set="compte" t-value="ligne['code'][0:2]"/>
	                        	</t>
	       						<t t-set="sumdeb" t-value="sumdeb+ligne['debit']"/>
								<t t-set="sumcre" t-value="sumcre+ligne['credit']"/>
								<t t-set="sumbase" t-value="sumbase+ligne['tax_amount']"/>                 	
	                        	
	                        	
	                        	
	                        	
	                        	
	                            <td ><span t-esc="ligne['code']"/>--<span t-esc="ligne['name']"/></td>
	                            <td class="text-left"><span t-esc="ligne['tax']"/></td>
	                            <td class="text-center"><span t-esc="'{0:,.2f}'.format(ligne['tax_amount'])"/></td>
	                            <td class="text-center"><span t-esc="'{0:,.2f}'.format(ligne['debit'])"/></td>
	                            <td class="text-center"><span t-esc="'{0:,.2f}'.format(ligne['credit'])"/></td>
	                            
	                            
	                            
	                            <t t-set="sumdeb_tot" t-value="sumdeb_tot+ligne['debit']"/>
								<t t-set="sumcre_tot" t-value="sumcre_tot+ligne['credit']"/>
								<t t-set="sumbase_tot" t-value="sumbase_tot+ligne['tax_amount']"/>
	                        </tr>        
	                    </tbody>
	                    	        <tr>
	                        			<td class="text-right" style="font-weight: bold;">Total compte</td>
	                    				<td class="text-right" style="font-weight: bold;"><span t-esc="compte"/></td>
	                    				<td class="text-center" style="font-weight: bold;"><span t-esc="'{0:,.2f}'.format(sumbase)"/></td>
	                    				<td class="text-center" style="font-weight: bold;"><span t-esc="'{0:,.2f}'.format(sumdeb)"/></td>
	                    				<td class="text-center" style="font-weight: bold;"><span t-esc="'{0:,.2f}'.format(sumcre)"/></td>
	                        		</tr>
	                    
	                    
	                    	<tr>
	                    		<td></td>
	                    		<td style="font-weight: bold;">TOTAL</td>
	                    		<td style="font-weight: bold;" class="text-center"><span t-esc="'{0:,.2f}'.format(sumbase_tot)"/></td>
	                    		<td style="font-weight: bold;" class="text-center"><span t-esc="'{0:,.2f}'.format(sumdeb_tot)"/></td>
	                    		<td style="font-weight: bold;" class="text-center"><span t-esc="'{0:,.2f}'.format(sumcre_tot)"/></td>
	                    		
	                    	
	                    	
	                    	</tr>
	                </table>
	            </div>
	        </t>
	    </t>
	</template>



        <report
            id="zenawtol.zen_report_vat3"
            model="zenawtol.reporttax"
            report_type="qweb-pdf"
            string="Account tax"
            name="zenawtol.zen_report_vat3"
            file="zenawtol.zenreport_vattemplate4"
        />
    
    
    
    
        <record id="view_zen_account_vat" model="ir.ui.view">
            <field name="name">Account Tax Declaration</field>
            <field name="model">zen.account.vat.declaration</field>
            <field name="arch" type="xml">
            <form string="Taxes Report">
                <label colspan="4" string="This menu prints a tax declaration based on invoices or payments. Select one or several periods of the fiscal year. The information required for a tax declaration is automatically generated by Odoo from invoices (or payments, in some countries). This data is updated in real time. That’s very useful because it enables you to preview at any time the tax that you owe at the start and end of the month or quarter."/>
                <group string="Taxes Report" col="4">
                    <field name="chart_tax_id"/>
                    <field name="fiscalyear_id"/>
                    <field name="display_detail"/>
                    <!--- <field name="based_on"/>--> <!-- the option based_on 'payment' is probably not fully compliant with what the users understand with that term. So, currently, it's seems better to remove it from the view to avoid further problems -->
                </group>

                <group string="Periods"  col="4">
                    <field name="period_from"  domain="[('fiscalyear_id', '=', fiscalyear_id)]"/>
                    <field name="period_to" domain="[('fiscalyear_id', '=', fiscalyear_id)]"/>
                </group>
                <footer>
                    <button name="create_vat" string="Print Tax Statement" type="object" class="oe_highlight"/>
                    or
                    <button string="Cancel" class="oe_link" special="cancel"/>
                </footer>
            </form>
            </field>
        </record>

        <record id="action_zen_accounty_vat" model="ir.actions.act_window">
            <field name="name">VAT Awtol</field>
            <field name="res_model">zen.account.vat.declaration</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_zen_account_vat"/>
            <field name="target">new</field>
        </record>

        <menuitem icon="STOCK_INDENT" action="action_zen_accounty_vat"
            id="menu_zzen_account_vat"
            parent="account.menu_tax_report" />
    </data>
</openerp>
